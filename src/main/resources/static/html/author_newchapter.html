<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新增章节</title>
    <script src="../js/author_login_js/jquery.js"></script>
    <script src="../js/author_login_js/vue.min.js"></script>
    <link href="../css/authorlogincss/base.css" rel="stylesheet">
    <link href="../css/authormsgcss/authormsg.css" rel="stylesheet">
    <link href="../css/authormsgcss/useradmin.css" rel="stylesheet">
    <link href="../css/authormsgcss/newchapter.css" rel="stylesheet">
    <link  type="text/css" rel="stylesheet" href="../layui/css/modules/layer/default/layer.css">
    <link type="text/css" href="../layui/css/layui.css" rel="stylesheet">
    <script type="text/javascript" src="../layui/layui.js"></script>
</head>
<body>
<div class="msg_box">
    <div class="msg_top">
        <div class="msg_top1">
            <div class="msg_top2">
                <a  title="爱阅读">爱阅读</a>
            </div>
            <div class="msg_top3">
                <h2 class="top_word login_w white">作者中心</h2>
            </div>
            <div class="msg_top4">
                <ul>
                    <li class="bgwrite select">
                        <a class="top_word login_w  black wordsize">原创小说</a>
                    </li>
                    <li class="noselect">
                        <a class="top_word login_w  black2 wordsize">自媒体/合作伙伴</a>
                    </li>
                </ul>
            </div>
            <div class="penname">
                <a href="author_massg.html" id="authorName">{{authorName}}</a>
                <a href="" class="w-link"><span class="w-icon phui-power sprites-app-1"></span>退出</a>
            </div>


        </div>
    </div>
    <div class="msg_middle">
        <div class="msg_table">
            <div class="col-sub ap-side-menu">
                <ul class="side-nav author-nav" id="J_SideNav">
                    <li class="all-works">
                        <h4>
                            <em></em>
                            <a href="authormsg.html">全部作品</a>
                            <a class="op" href="author_publish.html">发表</a>
                        </h4>
                    </li>
                    <li class="incomes ">
                        <h4>
                            <em></em>
                            <a href="author_money.html">我的收入</a>
                        </h4>
                    </li>
                    <li class="reward ">
                        <h4>
                            <em></em>
                            <a href="">福利奖励查询</a>
                        </h4>
                    </li>
                    <li class="comment ">
                        <h4>
                            <em></em>
                            <a href="author_reader.html">
                                读者评论<span></span>
                            </a>
                        </h4>
                    </li>
                    <li class="message ">
                        <h4>
                            <em></em>
                            <a href="">
                                消息中心<span></span>
                            </a>
                        </h4>
                    </li>
                    <li class="welfare ">
                        <h4>
                            <em></em>
                            <a href="#">作者福利</a>
                        </h4>
                    </li>
                    <li class="welfare-male ">
                        <h4>
                            <em></em>
                            <a href="" target="_blank">男频作者福利</a>
                        </h4>
                    </li>
                    <li class="welfare-female ">
                        <h4>
                            <em></em>
                            <a href="" target="_blank">女频作者福利</a>
                        </h4>
                    </li>

                    <li class="welfare-female ">
                        <h4>
                            <em></em>
                            <a href="">新手帮助</a>
                        </h4>
                    </li>


                </ul>

            </div>
        </div>
        <div class="msg_content big">
            <div class="form-name">上传
                {{bookName}}
                章节<a href="authormsg.html" id="J_BackToManage">返回</a></div>
            <div class="message-pop J_NoticeTip">
                发表作品中不得含有违法违规信息，包括但不限于淫秽色情、反动、违背主流道德观等有害信息。
                如发现作品中含有违法违规内容，网易云阅读将对违法违规作品进行删除处理，
                冻结作者账号并保留追究作者法律责任的权利。请各位作者自觉自律，切勿以身试法，
                共建和谐文明的网络环境。
            </div>
            <div class="cname">
                <div class="item-title"><em></em>章节序号：</div>
                <p style="float: left" class="sort">
                    <input type="text" id="section" name="sort" autocomplete="off"
                           class="input-txt :required :only_on_blur :max_length;20">
                </p>
                <div class="item-title"><em></em>章节名：</div>
                <p style="float: left" class="into">
                    <input type="text" value="" name="title" class="input-txt :required :only_on_blur :max_length;20"
                           id="J_ArticleTitle" autocomplete="off">
                    <span class="vanadium-advice vanadium-invalid" style="display:none" id="J_ChapterNameTip"></span>
                </p>
                <p class="vanadium-init">
                    建议使用常用模板命名章节序号 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    章节序号+章节名称的长度限20字以内

                </p>
            </div>
            <div class="cconcent">
                <div class="item-title"><em></em>章节内容：</div>
                <div class="editor ">
                    <textarea name="content" id="texts" autocomplete="off"></textarea>
                    <div class="bottom-bar"></div>
                </div>

            </div>
            <!--            <div class="vanadium-init" style="margin-top: 10px;">-->
            <!--                <span>章节内容里请不要包含标题，字数限制为100-10000字。-->
            <!--                    使用txt文件排版粘贴可能会导致错误，建议使用word文件进行排版。</span>-->
            <!--            </div>-->
            <div class="form-submit">
                <p href="#" class="form-btn " id="J_Submit">发布</p>
            </div>
        </div>
    </div>
    <div class="msg_bottom">
        <div class="footer">
            <a href="http://gb.corp.163.com/gb/about/overview.html" target="_blank">公司简介</a>
            - <a target="_blank" href="http://gb.corp.163.com/gb/contactus.html">联系我们</a>
            - <a href="http://corp.163.com/gb/job/job.html" target="_blank">招聘信息</a>
            - <a href="http://gb.corp.163.com/gb/legal.html" target="_blank">相关法律</a>
            - <a href="http://sitemap.163.com/" target="_blank">网站地图</a>
            - <a href="http://post.news.163.com/msg/jubao.jsp" target="_blank">不良信息举报</a>
            - <a href="https://yuedu.163.com/" target="_blank">网易云阅读官网</a>
            - <a href="/originalUserGuide.do">帮助中心</a><br>
            网易公司版权所有<br>
            <span class="cDRed">©1997-2019</span>
        </div>
    </div>
</div>
</body>
<script>
    // 显示作者名
    var aid = sessionStorage.getItem("aid");
    var layer ;
    layui.use('layer', function(){
        layer = layui.layer;
    });
    // alert(aid);
    $(function () {
        $.ajax({
            url: "/author/getAuthorName",
            data: {authorId: aid},
            type: "post",
            dataType: "json",
            success: function (data) {
                mv2 = new Vue({
                    el: "#authorName",
                    data: {authorName: data.authorName},
                });
                // alert(mv2.authorName);
            }
        })
    });
    //增加章节


    var bookid = sessionStorage.getItem("bookId");


    $(".form-submit").click(function () {
        var bookSort = $("#section").val();
        var bookTxet = $("#texts").val();
        var chapterNames = $("#J_ArticleTitle").val();

        $.ajax({
            url: "/author/newChapter",
            type: "post",
            data: {
                'bookId': bookid,
                'chapterSort': bookSort,
                'chapterName': chapterNames,
                'contentText': bookTxet,

            },
            dataType: "json",
            success: function (data) {
                if (data == true) {
                    layer.alert('发布成功!!!', {
                        icon: 1,
                        skin: 'layer-ext-moon'
                    });
                    setTimeout(function(){ window.location.reload([true]); }, 2000);
                    // sessionStorage.setItem("aid", result.author.authorId);
                } else {
                    layer.alert('发布失败!!!', {
                        icon: 2,
                        skin: 'layer-ext-moon'
                    });

                }
            },
            error: function () {
                layer.alert('Error!!!', {
                    icon: 2,
                    skin: 'layer-ext-moon'
                });
            }
        });

    });

    //接bookName
    var bookName = sessionStorage.getItem("bookName");
    mv5 = new Vue({
        el: '.form-name',
        data: {
            bookName: bookName,
        }
    });


    // 传id
    $(function () {
        $("#penname1").click(function () {
            var aid = sessionStorage.setItem("aid");
        })
    });

    $(function () {
        $(".all-works").click(function () {
            var aid = sessionStorage.setItem("aid");
        })
    });
    $(function () {
        $(".incomes").click(function () {
            var aid = sessionStorage.setItem("aid");
        })
    });
    $(function () {
        $(".comment").click(function () {
            var aid = sessionStorage.setItem("aid");
        })
    });
    $(function () {
        $(".op").click(function () {
            var aid = sessionStorage.setItem("aid");
        })
    });
    $(function () {
        $(".newc").click(function () {
            var aid = sessionStorage.setItem("aid");
        })
    });
</script>
<script type="text/javascript">
    $(function () {
        $("#section").keyup(function () {
            //如果输入非数字，则替换为''，如果输入数字，则在每4位之后添加一个空格分隔
            this.value = this.value.replace(/[^\d]/g, '');
        })
    });
</script>
</html>